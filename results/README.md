# Comparing nbsafety and nbgather

Author: shreyashankar

The steps to compare the two tools are, at a high level, as follows:

1. Filter out cells in the notebook that cannot be parsed by python's ast
2. Isolate the last line of code in the notebook into its own cell
3. Compute dependencies (at the statement level) for the last line in the notebook (note that for nbsafety, we actually have to run the notebook)
4. For nbsafety, verify that the slice, when run, produce the same output as the notebook did
5. For nbgather, verify that the slice can run

The relevant code to run the experiments lives under the `eda` folder, and the resulting slices for each notebook (trace, session tuple) produced by the tools are in the `results` folder. The data corresponding to notebooks and good sessions lives in the `data` folder. The 

To construct the `nbsafety` slices, you can run `python eda/run_all_nbsafety.py`, which invokes `eda/run_nbsafety.py` as a subprocess for each notebook. The slice is executed in `eda/run_nbsafety.py`. The stats are written to `stats.txt` in the root directory.

To construct the `nbgather` slices, you can run `python eda/run_nbgather.py`, which invokes `eda/nbgather/index.mjs` as a subprocess. Note that before you do this, you will need to `npm install` the modules in `eda/nbgather`. The stats are written to `nbgather_stats.txt` in the root directory. To execute the slices from `nbgather`, you can run `python eda/execute_nbgather_slices.py`.

Finally, the comparison plots can be generated by `notebooks/compare.ipynb`. If you are interested in comparing the code in the slices for a specific notebook (trace, session tuple), you can enter the relevant parameters in `notebook/compare_slices.ipynb` and run the cells in this notebook to see the code diff.


